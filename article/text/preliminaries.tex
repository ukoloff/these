% !TeX root = ..
\section{Общие соображения}\label{sec:pre}
Оба алгоритма,
разработанные и реализованные в данной работе,
используют общие основные идеи.

\subsection{Разбиение задачи}
В каждой вершине дерева поиска,
мы разделяем исходную задачу
на две (более простых) подзадачи
следующим образом:
\begin{enumerate}
	\item
	Рассмотрим подмножество
	$\CX'\subset\CX$,
	такое что $V_1\in\CX'$,
	зафиксируем некоторый кластер $V_l\in\CX'$
	и вершины $v\in V_1$ и $u\in V_l$
	соответственно
	\item
	пусть $c_{\min}$ -- нижняя граница стоимости $v-u$-путей,
	проходящих через все кластеры $\CX'$
	и удовлетворяющих ограничению предшествования\footnote{В нашем варианте динамического программирования эта граница будет точной}
	\item
	исключая из $\CX'$ все внутренние кластеры и соединяя
	$V_1$ с $V_l$ напрямую ребром нулевого (0) веса,
	мы тем самым создаём подзадачу $\P$,
	имеющую все те же остальные веса путей, разбиение на кластеры и ограничения предшествования,
	что и исходная
	\item
	принимая
	\begin{equation}\label{e:bounds}
		\LB = c_{\min} + \OPT{\P_{rel}}
	\end{equation}
	за нижнюю границу,
	мы отсекаем все узлы,
	для которых
	$\LB > \UB$.
	Здесь, $\OPT{\P_{rel}}$
	это вес некоторого эффективно находимого решения упрощённой задачи $\P$
	и $\UB$ -- стоимость наилучшего известного допустимого решения исходной задачи.
\end{enumerate}

\subsection{Нижние границы}\label{ssec:LBs}
В этом разделе мы сравним разные способы получения нижних границ
для вспомогательной проблемы
$\P$.
Рассмотрим несколько способов упростить
$\P$,
используя двухэтапный подход,
предложенный в
\cite{SALMAN2020163}.

На первом этапе мы упрощаем
$\P$,
превращая ее в задачу ATSP
одним из следующих способов:
\begin{enumerate}
	\item
	ослабляя исходное ограничение предшествования,
	исключаем все ребра
	$(v',v'')\in E$,
	для которых
	$(V(v''),V(v'))\in A$.
	Затем,
	сводим полученную задачу к ATSP,
	используя классическую трансформацию Нуна-Бина
	\cite{NoonBean1993}
	\item
	тем же способом ослабив исходное ограничение предшествования,
	сводим полученную задачу к ATSP,
	определённой на вспомогательном графе {\it кластеров}
	$H_1=(\tilde\CX',A_1, c_1)$, где
	\[
		\tilde\CX'=\CX\setminus\CX'\cup\{V_1,V_l\},
	\]
	\[\hspace*{-3ex}
	A_1=\{(V_1,V_l)\}\cup\{(V_i,V_j)\ |\  i>2, \{V_i,V_j\}\subset\tilde\CX', \exists (v'\in V_i, v''\in V_j)\colon (v',v'')\in E\},
	\]
	\[
	c_1(V_1,V_l) = 0,\ c_1(V_i,V_j) = \min\{c(v',v'')\colon v'\in V_i, v''\in V_j, (v',v'')\in E\}
	\]
	\item
	сводим исходную задачу к ATSP,
	определённой на ориентированном графе
	$H_2=(\tilde\CX',A_2, c_2)$,
	где
	\begin{multline*}
	A_2=\{(V_1,V_l)\}\cup\{(V_i, V_k)\ |\ i>2,\\ \exists (j>1): \{V_i,V_j,V_k\}\subset\tilde\CX' \wedge (\{(V_j,V_i), (V_k,V_j), (V_k, V_i)\}\cap A=\varnothing)\\
	 \wedge \exists (v'\in V_i, v''\in V_j, v'''\in V_k)\colon (\{(v',v''),(v'',v''')\}\subset E)\}\\
	\cup \{(V_i, V_k)\ |\ i>2, (\{V_i,V_k\}\subset\tilde\CX')\wedge ((V_k,V_i)\not\in A)\\
	\wedge \exists (v'\in V_i, v_1\in V_1, v''\in V_k)\colon \{(v',v_1), (v_1,v'')\}\subset E\},
	\end{multline*}
	то есть,
	для любого
	$V_i\in \tilde\CX'\setminus\{V_1\}$,
	упорядоченная пара $(V_i,V_k)\in A_2$,
	если существует $V_j\in\tilde\CX'$
	и вершины $v'\in V_i, v''\in V_j$
	и
	$v'''\in V_k$,
	такие, что путь $\pi = v',v'', v'''$
	не запрещён исходным ограничением предшествования
	$\Pi$.
	Далее,
	\[
	\hspace*{-3ex} c_2(V_1,V_l) = 0,
	\ c_2(V_i,V_k) = \min\{c(v',v'')+c(v'',v''')\colon \pi=v',v'', v''' \text{ -- допустимый путь}\}.
	\]
\end{enumerate}

На втором этапе,
мы находим приближенное решение полученной задачи ATSP,
путем нахождения либо минимального остовного дерева
(Minimum Spanning Arborescence Problem, MSAP),
либо решения задачи о назначениях
(Assignment Problem, AP)
и тем самым получаем значение нижней границы по формуле
\eqref{e:bounds}.
Кроме того,
мы можем посчитать ещё более точную
нижнюю границу,
прямо решая вспомогательную задачу ATSP
при помощи солвера Gurobi
(на практике только для задач, полученных способом 2).
Для удобства
все способы получения нижних границ сведены в
табл.~\ref{t:LBs}\subref{t:matrix}.

\begin{table}[h!]

\centering
	\scriptsize
    \caption{Нижние границы}\label{t:LBs}
    \subfloat[Обозначения]{\label{t:matrix}
    \begin{tabular}[t]{|c|c|c|c|}
    \hline
    & \textbf{Noon-Bean} & $\mathbf{H_1}$ & $\mathbf{H_2}$ \\
    \hline \hline
  \textbf{AP} & $E_1$ & $\mathbf{L_1}$ & $\mathbf{L_2}$\\
  \textbf{MSAP} & $E_2$ & $E_3$ & $E_4$\\
  \textbf{Gurobi} & $E_5$ & $\mathbf{L_3}$ & $E_6$\\
  \hline
    \end{tabular}
    }
   \quad
   \subfloat[Оценки по сравнению с $L_3$]{\label{t:confid}
   \begin{tabular}[t]{|*{3}{c|}}
   \hline
   $E_1$ & $E_2 = E_3$ &$E_4$ \\ \hline
   $0.48 \pm 0.03$ & $0.54 \pm 0.01$ & $0.60 \pm 0.002$\\ \hline \hline
   $L_1$ & $L_2$ & $L_3$ \\ \hline
   $0.91\pm 0.02$ & $0.97\pm 0.02$ & 1.00 \\
   \hline
   \end{tabular}
   }
\end{table}

На основе результатов численных экспериментов,
мы сократили полный список методов оценки нижней границы,
см. табл.~\ref{t:LBs}\subref{t:confid}.
На практике оценки
$L_1$--$L_3$
оказываются почти всегда наиболее строгими,
статистически значимо
с доверительным интервалом 95\%.
Мы также отказались от использования оценок
$E_5$ и $E_6$
ввиду того,
что они требуют гораздо большего времени счета.
Таким образом,
в разделе~\ref{sec:experiments}
мы ограничились использованием оценок
\[
	\LB_i = c_{\min} + L_i,\ i\in\{1,2,3\}.
\]

