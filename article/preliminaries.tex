%!TEX root = pcgtsp.tex
\section{Preliminaries}\label{sec:pre}
Both algorithms, the branch-and-bound and dynamic programming designed and implemented in this paper exploit the similar main idea. 

\subsection{Instance decomposition}
At any node of the search tree, we decompose the initial instance as follows: 
\begin{itemize}
	\item[(i)] consider a subset $\C'\subset\C$, such that $V_1\in\C'$, fix some cluster $V_l\in\C'$ and nodes $v\in V_1$ and $u\in V_l$, respectively
	\item[(ii)] let $c_{\min}$ be a lower bound for the minimum cost of $v-u$-paths traversing all the clusters in $\C'$ and fulfilling the precedence constraints\footnote{In our dynamic programming, this bound is tight} 
	\item[(iii)] excluding from $\C'$ all the inner clusters and connecting $V_1$ with $V_l$ directly by a zero-cost arc(s), we consider a smaller auxiliary subproblem $\P$, which inherits other transportation costs, clustering, and precedence constraints from the initial instance 
	\item[(iv)] taking 
	\begin{equation}\label{e:bounds}
		\LB = c_{\min} + \OPT{\P_{rel}}
	\end{equation}
	as a lower bound, we fathom the current node each time when $\LB > \UB$. Here, $\OPT{\P_{rel}}$ is the optimum of some efficiently solvable relaxation of $\P$ and $\UB$ is the cost of the best known feasible solution.
\end{itemize}
\subsection{Lower bounds}\label{ssec:LBs}
In this subsection, we compare the lower bounds obtained by several relaxations of the auxiliary problem $\P$. To relax $\P$, we use the two-stage approach proposed in \cite{SALMAN2020163}. 

At the first stage, we reduce $\P$ to the appropriate ATSP instance by one of the following ways:
\begin{itemize}
	\item[(i)] relax the initial precedence constraints by exclusion all the arcs $(v',v'')\in E$, for which $(V(v''),V(v'))\in A$. Then, reduce the obtained instance to ATSP using the classic Noon and Been transformation \cite{NoonBean1993}
	\item[(ii)] after the same relaxation of the precedence constraints, reduce the relaxed problem to the ATSP instance defined by the auxiliary \textit{cluster} graph $H_1=(\tilde\C',A_1, c_1)$, where
	\[
		\tilde\C'=\C\setminus\C'\cup\{V_1,V_l\},
	\]
	\[\hspace*{-3ex}
	A_1=\{(V_1,V_l)\}\cup\{(V_i,V_j)\ |\  i>2, \{V_i,V_j\}\subset\tilde\C', \exists (v'\in V_i, v''\in V_j)\colon (v',v'')\in E\},
	\]
	\[
	c_1(V_1,V_l) = 0,\ c_1(V_i,V_j) = \min\{c(v',v'')\colon v'\in V_i, v''\in V_j, (v',v'')\in E\}
	\]
	\item[(iii)] reduce the initial problem to the instance of ATSP defined by the digraph $H_2=(\tilde\C',A_2, c_2)$, for which
	\begin{multline*}
	A_2=\{(V_1,V_l)\}\cup\{(V_i, V_k)\ |\ i>2,\\ \exists (j>1): \{V_i,V_j,V_k\}\subset\tilde\C' \wedge (\{(V_j,V_i), (V_k,V_j), (V_k, V_i)\}\cap A=\varnothing)\\
	 \wedge \exists (v'\in V_i, v''\in V_j, v'''\in V_k)\colon (\{(v',v''),(v'',v''')\}\subset E)\}\\
	\cup \{(V_i, V_k)\ |\ i>2, (\{V_i,V_k\}\subset\tilde\C')\wedge ((V_k,V_i)\not\in A)\\
	\wedge \exists (v'\in V_i, v_1\in V_1, v''\in V_k)\colon \{(v',v_1), (v_1,v'')\}\subset E\},	
	\end{multline*}
	i.e., for any $V_i\in \tilde\C'\setminus\{V_1\}$, the ordered pair $(V_i,V_k)\in A_2$, if there exists $V_j\in\tilde\C'$ and nodes $v'\in V_i, v''\in V_j$ and $v'''\in V_k$, such that the path $\pi = v',v'', v'''$ is consistent with the initial preference constraints. 

	Then,  
	\[
	\hspace*{-3ex} c_2(V_1,V_l) = 0,\ c_2(V_i,V_k) = \min\{c(v',v'')+c(v'',v''')\colon \pi=v',v'', v''' \text{ is consistent}\}.
	\]
\end{itemize}

At the second stage, relaxing the obtained ATSP instance by reduction either to the Minimum Spanning Arborescence Problem (MSAP) or to the Assignment Problem (AP), we compute the appropriate lower bounds by equation \eqref{e:bounds}. In addition,  to increase the tightness of our lower bounds, we compute optimum values for some ATSP instances obtained by option (ii), using the solver Gurobi. For convenience, we present the designations for all the used lower bounds in Table \ref{t:LBs}\subref{t:matrix}. 

\begin{table}[h!]

\centering
	\scriptsize
    \caption{Lower bounds: (a) bound names; (b) for each bound we present 95\%-confidence interval for its averaged ratio to  $L_3$}\label{t:LBs}
    \subfloat[]{\label{t:matrix}
    \begin{tabular}[t]{|c|c|c|c|}
    \hline
    & \textbf{Noon-Bean} & $\mathbf{H_1}$ & $\mathbf{H_2}$ \\
    \hline \hline
  \textbf{AP} & $E_1$ & $\mathbf{L_1}$ & $\mathbf{L_2}$\\
  \textbf{MSAP} & $E_2$ & $E_3$ & $E_4$\\
  \textbf{Gurobi} & $E_5$ & $\mathbf{L_3}$ & $E_6$\\ 
  \hline 
    \end{tabular}
    }
   \quad
   \subfloat[]{\label{t:confid}
   \begin{tabular}[t]{|*{3}{c|}}
   \hline
   $E_1$ & $E_2 = E_3$ &$E_4$ \\ \hline
   $0.48 \pm 0.03$ & $0.54 \pm 0.01$ & $0.60 \pm 0.002$\\ \hline \hline
   $L_1$ & $L_2$ & $L_3$ \\ \hline
   $0.91\pm 0.02$ & $0.97\pm 0.02$ & 1.00 \\
   \hline
   \end{tabular}
   }
\end{table}

Relying on results of the exploratory experiments, we shorten the list of lower bounds employed in the subsequent evaluation 
(see Table \ref{t:LBs}\subref{t:confid}). Indeed, the bounds  $L_1$-$L_3$ appear to be tighter than others, which is statistically significant with a 95\% confidence level. Also, we skip bounds $E_5$ and $E_6$, whose computation leads to extremely high time consumption. Thus, in Section \ref{sec:experiments}, we restrict ourselves to the bounds 
\[
	\LB_i = c_{\min} + L_i,\ i\in\{1,2,3\}.
\]    

