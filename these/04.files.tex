%!TEX root = ../these.tex

\section{
  Использование открытых форматов файлов данных для взаимодействия подсистем
}
\label{ch:json.files}

Поскольку требуется обеспечить
совместную работу программного обеспечения,
разработанного в разное время разными командами разработчиков,
чрезвычайно важными становятся вопросы
организации эффективных программных интерфейсов.

Например, для хранения и обмена геометрической информацией
в САПР~<<Сириус>>
используется унаследованный двоичный формат DBS
\cite{bi:DBS},
который обладает важными достоинствами:
\begin{itemize}
  \item
  эффективное хранение больших данных за счёт хранения массивов вещественных чисел в формате IEE 754;
  \item
  возможность добавления новых типов записей для хранения ранее не предусмотренной информации;
  расширяемость формата
  \item
  механизм создания копий деталей и геометрических преобразований над ними.
\end{itemize}

В то же время,
работа с ним сопряжена с рядом сложностей,
прежде всего:
\begin{itemize}
  \item
  Сложность чтения двоичного формата,
  особенно в некоторых языках программирования
  \item
  Структура DBS-файла,
  предназначенная для эффективного хранения,
  сильно отличается от удобного внутреннего представления
  геометрии;
  требуется нетривиальное преобразование при чтении файла
  \item
  Формат DBS создавался в том числе для экономии памяти,
  как дисковой, так и оперативной,
  что более неактуально;
  отказ от этого позволяет резко упростить процедуры экспорта--импорта.
\end{itemize}

В рамках данной диссертационной работы
в целях упрощения взаимодействия различных подсистем
было принято решение использовать по возможности
открытые текстовые форматы для хранения и передачи данных.
В качестве основного формата был выбран формат
JavaScript Object Notation
(JSON
\cite{bi:JSON}),
ввиду того, что
он с одной стороны имеет готовые библиотеки для чтения и записи
для практически всех современных языков
программирования,
является стандартом де-факто во многих
современных приложениях для обмена данными,
довольно прост,
настолько, что может например,
формироваться даже без использования специализированных библиотек,
но при этом достаточно выразителен.

Для хранения и обмена информацией о геометрии деталей
и раскройной карты
была разработана наиболее простая схема JSON,
не включающая сложности с копиями деталей и геометрическими
преобразованиями.
Пример такого файла для простейшей раскройной карты
приведён в Листинге~\ref{lst:json-dbs}.

\lstinputlisting[
    language=Java,
    basicstyle=\footnotesize,
    showstringspaces=false,
    numbers=left,
    label={lst:json-dbs},
    captionpos=b,
    caption=JSON-файл с геометрией простейшей раскройной карты
    ]
    {media/nesting.json}

Использование JSON
в качестве формата обмена данными
оказалось удобным на практике,
поэтому позднее были разработаны другие
форматы файлов, в частности
задания на резку и результатов резки.
Все они были формально описаны в
виде JSON-схемы
\cite{bi:json-schema},
см.~\cite{bi:dbs-schema}.
