%!TEX root = ../these.tex

\subsection{Ветвление}
\label{sec:pgstcp.branch}

После того, как префикс
$\sigma=(V_{i_1}, V_{i_2}, \dots V_{i_r})$,
полностью обработан и не подвергся отсечению,
строится список его потомков,
подлежащих обработке.
Иными словами, ищется множество $\mathbb C$
кластеров $V_i$,
каждый из которых может быть добавлен в конец
текущего префикса.

В простейшей реализации префикс может быть
расширен на любой кластер,
который не нарушает ограничения предшествования
со всеми кластерами, уже находящимися в $\sigma$:
$$
\mathbb C^0(\sigma) =
  \left\{
    V^+|
      \forall V \in \sigma: (V^+, V) \notin A
  \right\}
  \setminus \sigma
$$

Однако, так же как было с применением ограничения предшествования
для релаксации PCGTSP $\to$ GTSP,
более внимательно рассмотрение позволяет
сильно сократить ветвление,
что чрезвычайно хорошо влияет
на общую производительность алгоритма.
Более строгое правило заключается в том,
что префикс может быть расширен на кластер,
все предки которого в частичном порядке $\Pi$
уже находятся в префиксе:
$$
\mathbb C(\sigma)=
  \left\{
    V^+|
    \forall V \in \mathcal C: (V, V^+)\in A \Rightarrow V \in \sigma
  \right\}
  \setminus \sigma
$$

По построенному множеству допустимых кластеров $\mathbb C(\sigma)$,
множество префиксов-потомков строится как
$\left\{\sigma + V| V \in \mathbb C(\sigma)\right\}$.
Все они ставятся в очередь на обработку.

\subsubsection{Сортировка ветвей}

Кроме ограничения количества ветвей,
оказалось,
что существенное влияние на производительность
алгоритма оказывает и порядок обработки ветвей.
Вычислительные эксперименты показали,
что размер дерева поиска систематически
оказывается меньше,
если первыми обрабатываются префиксы,
которые сами имеют наименьшее количество потомков
$|\mathbb C(\sigma+V)|$.
Именно такая сортировка и реализована
в данной диссертационной работе.

Причиной такого эффекта является по-видимому то,
что префиксы, обрабатываемые первыми,
имеют мало шансов быть отброшенными
по правилу~\eqref{eq:pcgtsp.cut.prefix},
а последние --- наоборот.
Выгодно отсекать более крупные поддеревья,
то есть те, которые содержат больше ветвей.

