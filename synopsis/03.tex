%!TEX root = ../synopsis.tex

В {\bf третьей главе} 
рассматривается обобщённая задача коммивояжера с
ограничениями предшествования ({\it PCGTSP}) --
это хорошо известная задача комбинаторной оптимизации,
имеющая множество приложений помимо
оптимизации траектории режущего инструмента 
и привлекшая внимание многих исследователей.
К сожалению,
в отличие от задачи GTSP,
алгоритмические подходы к решению 
именно PCGTSP всё ещё малочисленны.
Алгоритм, предложенный в данной диссертационной работе,
на основе синтеза нескольких идей других исследователей,
представляет собой попытку
создать первый точный алгоритм 
ветвей и границ для
решения задачи PCGTSP в общем виде.

Задача определяется тройкой
$(G,\mathcal C,\Pi)$, 
где
$G=(V,E,c)$ -- взвешенный ориентированный граф на $n$
вершинах,
задающий веса $c(u,v)$ для всех своих ребер
$(u,v)\in E, u, v \in V$;
$\mathcal C=\{V_1,\ldots,V_m\}$ -- разбиение вершин
графа $G$ на $m$ кластеров;
$ \Pi = (\mathcal C, A) $ -- частичный порядок,
заданный на множестве кластеров.
Для каждой вершины 
$v\in V$, за $V(v)$ 
обозначим (единственный) кластер 
$V_p\in\mathcal C$, 
такой что
$v\in V_p$. 

Допустимым решением задачи
$(G,\mathcal C,\Pi)$
называется тур (замкнутый путь) $T$,
удовлетворяющий условиям:
\begin{itemize}
    \item 
    имеет длину $|T|=m$
    \item
    начинается и заканчивается в некоторой вершине $v_1\in V_1$
    \item 
    посещает каждый кластер $V_p\in\mathcal C$
    \item
	каждое ребро
	$(v_i, v_j)$ в $T$ 
	(кроме ребра $(v_m,v_1)$) 
	удовлетворяет ограничению предшествования,
	то есть
	 $(V(v_i),V(v_j))\in A$.
\end{itemize}

Каждому решению
$T=v_1, v_2, \ldots, v_m$
мы назначаем стоимость
\begin{equation}
    \label{eq:pctgsp-cost}
	cost(T) = c(v_m,v_1) + \sum_{i=1}^{m-1} c(v_i,v_{i+1})
\end{equation}

Требуется найти допустимый тур 
$ T $ 
с минимальной стоимостью
$$ 
cost (T) \to \min_T 
$$

Ключевой идеей алгоритма является построение нижней оценки стоимости решения.
Для этого в каждой вершине дерева поиска исходная задача разделяется на две:
\begin{enumerate}
    \item 
    Фиксируется {\it префикс}
    маршрута $\sigma=\{V_1, \dots, V_r\}$.
    Обозначим $c_{min}$ нижнюю границу длины
    всех путей, проходящих из вершин кластера $V_1$
    в вершины кластера $V_r$ строго в порядке $\sigma$.
    \item 
    Построим вспомогательную задачу $\mathcal P$,
    удалив из исходной задачи все кластеры,
    являющиеся внутренними в $\sigma$ и 
    соединив все вершины из $V_1$ с вершинами $V_r$
    ребрами нулевого веса.
    Полученная таким образом задача всё ещё сложна,
    однако она может быть несколькими способами
    упрощена (релаксирована) $\mathcal P \to \mathcal P_{rel}$
    и для неё найдено оптимальное решение $\mathrm{OPT}(\mathcal P_{rel})$
\end{enumerate}
Нижняя оценка $LB$
находится как
\begin{equation}
    \label{eq:pcgtsp-lb}
    LB = c_{\min} + \mathrm{OPT}(\mathcal P_{rel})
\end{equation}

В качестве релаксации $\mathcal P_{rel}$ задачи $\mathcal P$
могут применяться:
\begin{itemize}
    \item 
    хорошо известная трансформация Noon-Bean,
    преобразующая задачу GTSP в обычную задачу
    коммивояжера TSP
    \item
    построение вспомогательного {\it графа кластеров} $H_1$
    с весами, индуцированными весами исходного графа $G$:
    $$
    c(V_i, V_j) = \min_{v_i \in V_i, v_j \in V_j} c(v_i, v_j)
    $$
    \item
    построение графа кластеров $H_2$, 
    веса в котором также индуцированы весами путей длины 2 в исходном графе $G$:
    $$
    c(V_i, V_j) = 
        \min_{\substack{v_i \in V_i, v_j \in V_j\\v_k \notin V_i \cup V_j}  } 
        \frac{c(v_i, v_k) + c(v_k, v_j)}{2}
    $$
    при этом маршрут $v_i, v_k, v_j$ должен удовлетворять ограничению предшествования $\Pi$.
    Этот способ позволяет точнее учитывать взаимное расположение контуров на плоскости
    в случае Евклидовой задачи PCGTSP
    \item 
    по аналогии с $H_2$ могут строиться кластерные графы с весами на основе
    путей большей ($\geqslant 3$) длины,
    однако алгоритм их расчёта существенно сложнее и
    не входит в рамки данной диссертационной работы
\end{itemize}

Наконец, для (быстрого) поиска
нижней оценки на решение задачи $TSP(\mathcal P_{rel})$
можно использовать:
\begin{itemize}
    \item 
    Решение задачи о минимальном остовном дереве
    (Minimal Spanning Arborescence, MSAP),
    так как $MSAP(\mathcal P) \leqslant TSP(\mathcal P)$
    \item
    Решение задачи о цикловом покрытии (Cycle cover);
    оно находится как решение задачи о назначениях
    (Assignment Problem, AP) 
    для двудольного графа,
    обе доли которого представляют $\mathcal P_{rel}$;
    опять $AP(\mathcal P) \leqslant TSP(\mathcal P)$
    \item
    в некоторых случаях можно прямо решить задачу 
    коммивояжера $TSP(\mathcal P)$.
    В данной работе для этого использовался решатель Gurobi
    и MIP-модель ATSPxy.
\end{itemize}

Все возможные методы оценки нижней границы показаны в табл.~\ref{t:LBs},
используемые в описываемой реализации обозначены
$L_1$--$L_3$,
не используемые -- 
$E_1$--$E_6$.
Проведённые численные эксперименты показывают,
что часть методов
($E_1$--$E_4$)
систематически дают более слабые оценки,
а часть
($E_1$--$E_2$, $E_5$--$E_6$)
требуют значительных временных затрат по сравнению с выбранными.
Оценка $L_3$ 
в этом смысле является компромиссом,
причём она вычисляется только для малой доли
префиксов
($\approx 1\%$)
с наименьшей оценкой, полученной методами
$L_1$--$L_2$.


\begin{table}
    \centering
    \caption{Методы оценки нижней границы}\label{t:LBs}
    \begin{tabular}[t]{*{5}{|c}|}
        \hline
        & \textbf{Noon-Bean} & $\mathbf{H_1}$ & $\mathbf{H_2}$ & $\mathbf{H_{3+}}$\\
        \hline \hline
      \textbf{AP} & $E_1$ & $\mathbf{L_1}$ & $\mathbf{L_2}$ & - \\
      \textbf{MSAP} & $E_2$ & $E_3$ & $E_4$ & - \\
      \textbf{Gurobi} & $E_5$ & $\mathbf{L_3}$ & $E_6$ & -\\ 
      \hline 
    \end{tabular}    
\end{table}